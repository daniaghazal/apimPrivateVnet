name: Test-Env

on:  
 push:
   branches:
     - features/deploywebapp

env:
  APIM_RESOURCE_GROUP_NAME: ${{ secrets.APIM_RESOURCE_GROUP_NAME }}
  ON_PREM_RESOURCE_GROUP_NAME: ${{ secrets.ON_PREM_RESOURCE_GROUP_NAME }}
  LOCATION: ${{ secrets.LOCATION }}

jobs:
  compile_bicep:
    runs-on: ubuntu-latest 

    steps:
      - uses: actions/checkout@v2
      
      # Compile bicep files
      - name: Bicep Build
        uses: aliencube/bicep-build-actions@v0.1
        with:
          files: bicep/deploy.bicep bicep/onpremise.bicep

      # Deploy ARM Template
      - name: Publish ARM Template
        uses: actions/upload-artifact@v2.2.2
        with:            
          path: |
            bicep/deploy.json
            bicep/onpremise.bicep
